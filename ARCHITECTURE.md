# Pixy Terrain Architecture

## Overview

A terrain system for 3D pixel art games that creates a "diorama pedestal" effect.

```
        ~~~~ terrain surface (bumpy, transvoxel) ~~~~
       /                                            \
      |                                              |
WALL  |         solid volume below surface           |  WALL
      |                                              |
      |______________________________________________|
                      FLOOR (flat)
```

## Components

### 1. Top Surface (Transvoxel)
- Noise-based terrain generated by transvoxel algorithm from SDF
- Bumpy, organic, follows Perlin/FBM noise
- **This is the ONLY geometry transvoxel should generate**

### 2. Walls (box_geometry.rs)
- Vertical faces forming a "skirt" or "apron" below the terrain
- Wall TOPS follow the terrain contour (tessellated to match terrain height)
- Wall BOTTOMS sit on the floor
- Generated as explicit quad geometry

### 3. Floor (box_geometry.rs)
- Flat horizontal surface at the bottom
- Simple quad geometry

## Sharp 90Â° Corners

Sharp corners exist ONLY at:
- Wall-to-wall junctions (the 4 vertical corners)
- Wall-to-floor junctions (bottom edges)

Wall tops do NOT have sharp corners - they seamlessly meet the terrain surface.

## What Transvoxel Must NOT Generate

- NO floor geometry
- NO wall geometry
- ONLY the top terrain surface

## SDF Design

The signed distance field in `noise_field.rs` must be designed so transvoxel only creates the top surface:

- **Below floor**: Return deep solid (-1000) to prevent floor surface generation
- **At walls**: Must NOT create zero-crossings that would generate wall geometry

### The +1000 Problem

Returning `+1000` (air) outside walls creates a zero-crossing:
```
Inside wall:  terrain_sdf = -5 (solid)
Outside wall: +1000 (air)
```
Transvoxel meshes this transition as vertical wall geometry, which overlaps with explicit wall quads.

### Correct Approach

Options to prevent wall geometry from transvoxel:
1. Clamp sample coordinates to wall boundaries (no discontinuity)
2. Ensure transvoxel never samples outside walls
3. Return values that don't create zero-crossings at walls
